<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰›å¤©é½çš„è®°å½•å°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #0A84FF; /* iOS systemBlue */
            --secondary: #F2F2F7; /* iOS grouped background */
            --text: #1C1C1E; /* iOS label color */
            --light-text: #6C6C70; /* iOS secondary label color */
            --success: #32D74B; /* iOS systemGreen */
            --danger: #FF453A; /* iOS systemRed */
            --warning: #FFD60A; /* iOS systemYellow */
            --substitution: #BF5AF2; /* iOS systemPurple */
            --shadow-soft: 0 6px 16px rgba(10, 132, 255, 0.18);
            --shadow-press: 0 2px 8px rgba(0, 0, 0, 0.18);
            --radius: 14px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            background-color: var(--secondary);
            color: var(--text);
            padding-bottom: calc(70px + env(safe-area-inset-bottom, 0px));
            font-size: 15px;
            line-height: 1.55;
        }
        
        .container {
            max-width: 100%;
            padding: 0;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), #0d5bb5);
            color: white;
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .score-display {
            background: white;
            padding: 20px 15px;
            text-align: center;
            margin: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            position: relative;
        }
        
        .score-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-bottom: 10px;
        }
        
        .team-score {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .team-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--light-text);
        }
        
        .game-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
            color: var(--light-text);
            font-size: 13px;
        }
        
        .main-content {
            padding: 15px;
        }
        
        .section-title {
            font-size: 16px;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }
        
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .player-card {
            background: white;
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid #eaeaea;
        }
        
        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .player-card.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .player-card.playing {
            border-left: 4px solid var(--success);
        }
        
        .player-number {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .player-name {
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .action-btn {
            border: none;
            border-radius: var(--radius);
            font-size: 15px;
            cursor: pointer;
            text-align: center;
            transition: transform 0.15s ease, box-shadow 0.2s ease, background-color 0.2s ease;
            font-weight: 600;
            width: 100%;
            padding: 12px 16px;
            min-height: 44px;
            -webkit-tap-highlight-color: transparent;
            background: #fff;
            color: var(--text);
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.08);
        }
        
        .action-btn:active {
            transform: scale(0.98);
            box-shadow: var(--shadow-press);
        }
        
        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: #fff;
            box-shadow: 0 2px 6px rgba(10, 132, 255, 0.24);
        }
        .btn-primary:hover { filter: brightness(1.03); }
        .btn-primary:active { filter: brightness(0.98); box-shadow: var(--shadow-press); }
        
        .btn-success {
            background-color: var(--success);
            color: #fff;
            box-shadow: 0 2px 6px rgba(50, 215, 75, 0.22);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: #fff;
            box-shadow: 0 2px 6px rgba(255, 69, 58, 0.22);
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: #1C1C1E;
            box-shadow: 0 2px 6px rgba(255, 214, 10, 0.22);
        }
        
        .btn-substitution {
            background-color: var(--substitution);
            color: #fff;
            box-shadow: 0 2px 6px rgba(191, 90, 242, 0.22);
        }
        
        .btn-small {
            padding: 8px 6px;
            font-size: 12px;
        }
        
        .opponent-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #eaeaea;
        }
        
        .events-log {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 13px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .event-item {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .event-item:last-child {
            border-bottom: none;
        }
        
        .event-undo {
            color: #0A84FF;
            cursor: pointer;
            font-size: 11px;
            padding: 6px 10px;
            border-radius: 9999px;
            background: rgba(10, 132, 255, 0.12);
            border: 1px solid rgba(10, 132, 255, 0.35);
            transition: transform 0.15s ease, background-color 0.2s ease, box-shadow 0.2s ease;
        }
        
        .event-undo:hover {
            background: rgba(10, 132, 255, 0.18);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(10, 132, 255, 0.18);
        }
        
        .event-undo:active {
            transform: scale(0.98);
            box-shadow: var(--shadow-press);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap; /* è‡ªåŠ¨æ¢è¡Œï¼Œé˜²æ­¢çª„å±æº¢å‡º */
            justify-content: space-between;
            background: white;
            padding: 15px env(safe-area-inset-left,0px) 15px env(safe-area-inset-right,0px);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            border-top: 1px solid #eaeaea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .player-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.2s;
        }
        
        .form-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .player-list {
            margin-top: 20px;
        }
        
        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .player-status {
            font-size: 11px;
            color: var(--light-text);
            margin-top: 3px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: modalAppear 0.3s ease;
        }
        
        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .player-stats {
            margin-top: 8px;
            font-size: 11px;
            color: var(--light-text);
        }
        
        .undo-btn {
            background-color: var(--warning);
            color: #1C1C1E;
            border: none;
            border-radius: var(--radius);
            padding: 8px 14px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.15s ease, box-shadow 0.2s ease;
            min-height: 36px;
            box-shadow: 0 2px 6px rgba(255, 214, 10, 0.22);
        }
        
        .undo-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(255, 214, 10, 0.26);
        }
        
        .undo-btn:active {
            transform: scale(0.98);
            box-shadow: var(--shadow-press);
        }

        /* ----------- å°å±é€‚é… ----------- */
        @media (max-width: 420px) {
            .players-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 8px;
            }
            .team-score {
                font-size: 28px;
            }
            .player-card {
                padding: 10px 6px;
            }
            .action-btn {
                font-size: 12px;
                padding: 10px 6px;
            }
            header {
                padding: 12px 10px;
            }
        }
        
        .shot-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .shot-option {
            flex: 1;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .shot-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .shot-made {
            background-color: var(--success);
            color: white;
        }
        
        .shot-missed {
            background-color: var(--danger);
            color: white;
        }
        
        .rebound-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .rebound-option {
            flex: 1;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            background-color: var(--primary);
            color: white;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .rebound-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .reset-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--danger);
            color: #fff;
            border: none;
            border-radius: 9999px;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.15s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 6px rgba(255, 69, 58, 0.22);
        }
        
        .reset-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(255, 69, 58, 0.26);
        }
        
        .reset-btn:active {
            transform: scale(0.98);
            box-shadow: var(--shadow-press);
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .actions-grid {
                grid-template-columns: 1fr;
            }
            
            .action-btn {
                padding: 14px 8px;
                font-size: 14px;
            }
            
            .btn-small {
                padding: 10px 6px;
                font-size: 13px;
            }
            
            /* æ¢äººæŒ‰é’®åœ¨ç§»åŠ¨ç«¯æ›´æ˜¾çœ¼ */
            #substitution-btn {
                background-color: var(--substitution);
                font-weight: bold;
                border: 2px solid #7b1fa2;
            }
            
            .players-grid {
                grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));
                gap: 12px;
            }
            
            .player-card {
                padding: 14px 8px;
            }
            
            .player-number {
                font-size: 20px;
            }
            
            .player-name {
                font-size: 13px;
            }
            
            /* ç§»åŠ¨ç«¯å¸ƒå±€ä¼˜åŒ–ï¼Œå‡å°‘æ»šåŠ¨ */
            .main-content {
                padding: 12px;
            }
            
            .score-display {
                margin: 8px;
                padding: 15px 10px;
            }
            
            .team-score {
                font-size: 32px;
            }
            
            .opponent-section {
                margin: 15px 0;
                padding: 12px;
            }
            
            .events-log {
                max-height: 150px;
            }
        }
        
        @media (max-width: 480px) {
            .players-grid {
                grid-template-columns: repeat(auto-fill, minmax(75px, 1fr));
            }
            
            .action-btn {
                padding: 16px 8px;
                font-size: 15px;
            }
            
            .controls {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .controls .action-btn {
                flex: 1;
                min-width: 45%;
                font-size: 13px;
                padding: 12px 5px;
            }
            
            .score-container {
                gap: 15px;
            }
            
            .team-score {
                font-size: 28px;
            }
        }
        
        @media (max-width: 360px) {
            .players-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            }
            
            .player-number {
                font-size: 18px;
            }
            
            .player-name {
                font-size: 12px;
            }
            
            .main-content {
                padding: 10px;
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 20px;
            color: var(--light-text);
            font-style: italic;
        }
        /* ----------------- Sidebar & UI overrides (added) ----------------- */
        /* å°†åº•éƒ¨æ§ä»¶æ”¹ä¸ºå·¦ä¾§ä¾§è¾¹æ çš„è¦†ç›–æ ·å¼ï¼ˆä¸æ”¹å˜ä¸»è¦é¢œè‰²å˜é‡ï¼‰ */
        .controls {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 220px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 20px 16px;
            background: linear-gradient(180deg, rgba(13,24,48,0.98), rgba(6,14,30,0.98));
            color: #fff;
            box-shadow: 2px 0 18px rgba(0,0,0,0.12);
            z-index: 200;
        }

        .controls .brand { display:flex; align-items:center; gap:10px; font-weight:700; }
        .controls .nav-btn { display:flex; align-items:center; gap:10px; padding:12px 14px; border-radius:10px; background:rgba(255,255,255,0.03); color:#fff; border:none; cursor:pointer; text-align:left; transition:background .18s, transform .12s; }
        .controls .nav-btn:hover { background:rgba(255,255,255,0.07); transform:translateX(6px); }
        .controls .nav-spacer { flex:1; }
        .controls .footer-btn { margin-top:auto; width:100%; padding:12px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700; }

        /* score card spacing to account for sidebar */
        .score-display { margin: 14px 240px 18px 240px; padding:26px 22px; border-radius:14px; box-shadow:0 10px 30px rgba(10,132,255,0.06); display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; position:relative; }
        .score-display .score-block { flex:1 1 40%; }
        .score-display .score-center { flex:0 0 80px; font-size:22px; color:var(--primary); font-weight:700; }
        .score-display .score-container { width:100%; display:flex; justify-content:center; align-items:center; gap:36px; }
        .score-display .game-info { width:100%; display:flex; justify-content:center; gap:12px; margin-top:12px; }
        .main-content { margin-left: 240px; }

        /* player card tweaks */
        .player-card { border-radius:12px; padding:16px 12px; min-height:96px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; box-shadow:0 6px 18px rgba(10,10,30,0.04); border:1px solid rgba(10,10,30,0.04); transition:transform .18s, box-shadow .22s, background .18s, border-color .18s; text-align:center; cursor:pointer; }
        .player-card:hover { transform:translateY(-6px); box-shadow:0 18px 36px rgba(10,10,30,0.06); }
        .player-card:focus { outline: none; box-shadow: 0 0 0 4px rgba(10,132,255,0.08); transform: translateY(-4px); }
        .player-card.active { background: linear-gradient(135deg, rgba(10,132,255,0.06), rgba(255,255,255,0.02)); color:var(--text); border:2px solid var(--primary); box-shadow:0 24px 48px rgba(10,132,255,0.08); position:relative; transform: scale(1.06); }
        .player-card.active::after { content: 'âœ“'; position:absolute; top:8px; right:8px; background:var(--primary); color:#fff; width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; box-shadow:0 4px 10px rgba(10,10,30,0.08); }

        .player-card.playing { transform: scale(1.04); border: 2px solid rgba(50,215,75,0.12); }

        /* players grid: make cards larger and fill each row proportionally */
        .players-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:12px; }
        .player-number { font-size:22px; font-weight:800; color:var(--primary); }
        .player-name { font-size:14px; color:var(--text); }

        /* record area split columns */
        .record-columns { display:grid; grid-template-columns: 1fr 1fr; gap:20px; align-items:start; }
        .left-col, .right-col { display:flex; flex-direction:column; gap:12px; }

        /* tab transitions */
        .tab-content { display:none; opacity:0; transform:translateY(18px); transition:opacity .36s cubic-bezier(.2,.8,.2,1), transform .36s cubic-bezier(.2,.8,.2,1); }
        .tab-content.active { display:block; opacity:1; transform:translateY(0); }

        /* responsive adjustments: when small screen, hide sidebar and restore bottom controls */
        @media (max-width: 900px) {
            .controls { position: fixed; left: 0; right: 0; bottom: 0; top: auto; width: 100%; height: auto; flex-direction:row; justify-content:center; padding:12px; background: #fff; color: var(--text); box-shadow: 0 -8px 30px rgba(0,0,0,0.06); }
            .controls .brand, .controls .nav-spacer { display:none; }
            .controls .nav-btn { background: transparent; color: var(--text); padding: 8px 10px; }
            .score-display { margin: 14px 16px 96px 16px; }
            .main-content { margin-left: 0; padding-bottom: 84px; }
            .players-grid { grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); }
        }

        /* æ¢äººæ¨¡æ€æ¡†ï¼šæŠŠçƒå‘˜å¡æ‘Šå¼€ä¸ºæ–¹å½¢å¤šåˆ—ç½‘æ ¼ï¼Œå‡å°‘æ»šåŠ¨ */
        #substitution-modal .modal-content { max-height: 80vh; overflow: auto; }
        #substitution-modal .players-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(88px, 1fr)); gap:10px; align-items:stretch; }
        #substitution-modal .player-card { padding:8px; min-height:0; aspect-ratio: 1 / 1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; }
        #substitution-modal .player-number { font-size:18px; font-weight:800; }
        #substitution-modal .player-name { font-size:12px; }
        /* åœ¨æ¨¡æ€æ¡†å†…é€‰ä¸­é«˜äº®ä¸è¦å¤ªæ”¾å¤§ä»¥å…æŒ¤å å¸ƒå±€ */
        #substitution-modal .player-card.active { transform: translateY(-4px); border:2px solid var(--primary); box-shadow:0 12px 24px rgba(10,132,255,0.06); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <h1>ç»Ÿé™¢ç”·ç¯®è®°å½•å°</h1>
                </div>
                <div class="game-status">
                    <span>ç¬¬1èŠ‚</span>
                </div>
            </div>
        </header>
        
        <div class="score-display">
            <button class="reset-btn" onclick="showResetModal()">é‡ç½®æ•°æ®</button>
            <div class="score-container">
                <div>
                    <div class="team-name">ç»Ÿé™¢ç”·ç¯®</div>
                    <div class="team-score" id="home-score">0</div>
                </div>
                <div style="font-size: 28px; color: var(--primary);">:</div>
                <div>
                    <div class="team-name">èœé¸Ÿ</div>
                    <div class="team-score" id="away-score">0</div>
                </div>
            </div>
            <div class="game-info">
                <span>ç¬¬ <span id="quarter">1</span> èŠ‚</span>
                <button class="undo-btn" onclick="undoLastAction()">æ’¤é”€ä¸Šä¸€æ­¥</button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- æ¯”èµ›è®°å½•æ ‡ç­¾ -->
            <div class="tab-content active" id="record-tab">
                <div class="record-columns">
                    <div class="left-col">
                        <div class="section-title">
                            <span>é€‰æ‹©çƒå‘˜</span>
                            <span id="playing-count">åœºä¸Š: 5/5</span>
                        </div>
                        <div class="players-grid" id="players-container">
                            <!-- çƒå‘˜å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </div>

                        <div class="section-title">æˆ‘æ–¹å¾—åˆ†</div>
                        <div class="actions-grid">
                            <button class="action-btn btn-success" onclick="showShotModal(2)">2åˆ†çƒ</button>
                            <button class="action-btn btn-success" onclick="showShotModal(3)">3åˆ†çƒ</button>
                            <button class="action-btn btn-success" onclick="showFreeThrowModal()">ç½šçƒ</button>
                        </div>

                        <div class="section-title">å…¶ä»–æ•°æ®</div>
                        <div class="actions-grid">
                            <button class="action-btn btn-warning btn-small" onclick="showReboundModal('home')">ç¯®æ¿</button>
                            <button class="action-btn btn-warning btn-small" onclick="recordStat('assist')">åŠ©æ”»</button>
                            <button class="action-btn btn-warning btn-small" onclick="recordStat('steal')">æŠ¢æ–­</button>
                            <button class="action-btn btn-warning btn-small" onclick="recordStat('block')">ç›–å¸½</button>
                            <button class="action-btn btn-warning btn-small" onclick="recordStat('turnover')">å¤±è¯¯</button>
                            <button class="action-btn btn-warning btn-small" onclick="recordStat('foul')">çŠ¯è§„</button>
                            <button class="action-btn btn-substitution btn-small" id="substitution-btn" onclick="showSubstitutionModal()">æ¢äºº</button>
                        </div>
                    </div>

                    <div class="right-col">
                        <div class="opponent-section">
                            <div class="section-title">å¯¹æ‰‹æ•°æ®</div>
                            <div class="actions-grid">
                                <button class="action-btn btn-danger" onclick="showOpponentShotModal(2)">å¯¹æ‰‹2åˆ†</button>
                                <button class="action-btn btn-danger" onclick="showOpponentShotModal(3)">å¯¹æ‰‹3åˆ†</button>
                                <button class="action-btn btn-danger" onclick="showOpponentFreeThrowModal()">å¯¹æ‰‹ç½šçƒ</button>
                                <button class="action-btn btn-danger btn-small" onclick="showReboundModal('away')">å¯¹æ‰‹ç¯®æ¿</button>
                                <button class="action-btn btn-danger btn-small" onclick="recordOpponentStat('turnover')">å¯¹æ‰‹å¤±è¯¯</button>
                            </div>
                        </div>

                        <div class="section-title">äº‹ä»¶è®°å½•</div>
                        <div class="events-log" id="events-container">
                            <div class="empty-state">æš‚æ— äº‹ä»¶è®°å½•</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- çƒå‘˜ç®¡ç†æ ‡ç­¾ -->
            <div class="tab-content" id="manage-tab">
                <div class="section-title">æ·»åŠ çƒå‘˜</div>
                <div class="player-form">
                    <div class="form-group">
                        <label for="player-name">çƒå‘˜å§“å</label>
                        <input type="text" id="player-name" placeholder="è¾“å…¥çƒå‘˜å§“å">
                    </div>
                    <div class="form-group">
                        <label for="player-number">çƒè¡£å·ç </label>
                        <input type="number" id="player-number" placeholder="è¾“å…¥çƒè¡£å·ç " min="0" max="99">
                    </div>
                    <button class="action-btn btn-primary" onclick="addPlayer()">æ·»åŠ çƒå‘˜</button>
                </div>
                
                <div class="section-title">çƒå‘˜åˆ—è¡¨</div>
                <div class="player-list" id="players-list">
                    <!-- çƒå‘˜åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                </div>
            </div>
        </div>
        
        <div class="controls" id="sidebar">
            <div class="brand">
                <div style="width:34px;height:34px;background:rgba(255,255,255,0.12);border-radius:8px;display:flex;align-items:center;justify-content:center;">âš¡</div>
                <div>ç»Ÿé™¢ç”·ç¯®è®°å½•å°</div>
            </div>

            <button class="nav-btn" onclick="switchTab('record')">ğŸ“‹ æ¯”èµ›è®°å½•</button>
            <button class="nav-btn" onclick="switchTab('manage')">ğŸ‘¥ çƒå‘˜ç®¡ç†</button>
            <button class="nav-btn" onclick="exportToExcel()">ğŸ“¤ å¯¼å‡ºExcel</button>

            <div class="nav-spacer"></div>

            <button class="footer-btn btn-primary" onclick="nextQuarter()">ä¸‹ä¸€èŠ‚ â†’</button>
        </div>
    </div>

    <!-- å„ç§æ¨¡æ€æ¡† -->
    <div class="modal" id="substitution-modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px;">æ¢äººè°ƒæ•´</h3>
            
            <div style="margin-bottom: 15px;">
                <h4>é€‰æ‹©ä¸‹åœºçƒå‘˜</h4>
                <div id="out-players" class="players-grid">
                    <!-- ä¸‹åœºçƒå‘˜å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <h4>é€‰æ‹©ä¸Šåœºçƒå‘˜</h4>
                <div id="in-players" class="players-grid">
                    <!-- ä¸Šåœºçƒå‘˜å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button class="action-btn btn-primary" onclick="confirmSubstitution()" style="flex: 1;">ç¡®è®¤æ¢äºº</button>
                <button class="action-btn btn-danger" onclick="closeModal('substitution-modal')" style="flex: 1;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- æŠ•ç¯®æ¨¡æ€æ¡† -->
    <div class="modal" id="shot-modal">
        <div class="modal-content">
            <h3 id="shot-modal-title" style="margin-bottom: 15px;">æŠ•ç¯®è®°å½•</h3>
            <p id="shot-modal-description">é€‰æ‹©æŠ•ç¯®ç»“æœï¼š</p>
            
            <div class="shot-options">
                <div class="shot-option shot-made" onclick="confirmShot(true)">å‘½ä¸­</div>
                <div class="shot-option shot-missed" onclick="confirmShot(false)">æŠ•ä¸¢</div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="action-btn btn-danger" onclick="closeModal('shot-modal')" style="flex: 1;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ç½šçƒæ¨¡æ€æ¡† -->
    <div class="modal" id="free-throw-modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px;">ç½šçƒè®°å½•</h3>
            <p>é€‰æ‹©ç½šçƒç»“æœï¼š</p>
            
            <div class="shot-options">
                <div class="shot-option shot-made" onclick="confirmFreeThrow(true)">å‘½ä¸­</div>
                <div class="shot-option shot-missed" onclick="confirmFreeThrow(false)">æŠ•ä¸¢</div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="action-btn btn-danger" onclick="closeModal('free-throw-modal')" style="flex: 1;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ç¯®æ¿æ¨¡æ€æ¡† -->
    <div class="modal" id="rebound-modal">
        <div class="modal-content">
            <h3 id="rebound-modal-title" style="margin-bottom: 15px;">ç¯®æ¿è®°å½•</h3>
            <p id="rebound-modal-description">é€‰æ‹©ç¯®æ¿ç±»å‹ï¼š</p>
            
            <div class="rebound-options">
                <div class="rebound-option" onclick="confirmRebound('offensive')">è¿›æ”»ç¯®æ¿</div>
                <div class="rebound-option" onclick="confirmRebound('defensive')">é˜²å®ˆç¯®æ¿</div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="action-btn btn-danger" onclick="closeModal('rebound-modal')" style="flex: 1;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- å¯¹æ‰‹æŠ•ç¯®æ¨¡æ€æ¡† -->
    <div class="modal" id="opponent-shot-modal">
        <div class="modal-content">
            <h3 id="opponent-shot-modal-title" style="margin-bottom: 15px;">å¯¹æ‰‹æŠ•ç¯®è®°å½•</h3>
            <p id="opponent-shot-modal-description">é€‰æ‹©æŠ•ç¯®ç»“æœï¼š</p>
            
            <div class="shot-options">
                <div class="shot-option shot-made" onclick="confirmOpponentShot(true)">å‘½ä¸­</div>
                <div class="shot-option shot-missed" onclick="confirmOpponentShot(false)">æŠ•ä¸¢</div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="action-btn btn-danger" onclick="closeModal('opponent-shot-modal')" style="flex: 1;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- å¯¹æ‰‹ç½šçƒæ¨¡æ€æ¡† -->
    <div class="modal" id="opponent-free-throw-modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px;">å¯¹æ‰‹ç½šçƒè®°å½•</h3>
            <p>é€‰æ‹©ç½šçƒç»“æœï¼š</p>
            
            <div class="shot-options">
                <div class="shot-option shot-made" onclick="confirmOpponentFreeThrow(true)">å‘½ä¸­</div>
                <div class="shot-option shot-missed" onclick="confirmOpponentFreeThrow(false)">æŠ•ä¸¢</div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="action-btn btn-danger" onclick="closeModal('opponent-free-throw-modal')" style="flex: 1;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- é‡ç½®ç¡®è®¤æ¨¡æ€æ¡† -->
    <div class="modal" id="reset-modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px;">é‡ç½®ç¡®è®¤</h3>
            <p>ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼</p>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="action-btn btn-danger" onclick="resetData()" style="flex: 1;">ç¡®è®¤é‡ç½®</button>
                <button class="action-btn btn-primary" onclick="closeModal('reset-modal')" style="flex: 1;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ•°æ®
        let players = [];
        let selectedPlayerId = null;
        let homeScore = 0;
        let awayScore = 0;
        let quarter = 1;
        let events = [];
        let actionHistory = [];
        
        // æŠ•ç¯®æ•°æ®
        let shotData = {};
        let opponentShotData = {
            twoAttempts: 0,
            twoMade: 0,
            threeAttempts: 0,
            threeMade: 0,
            fta: 0,
            ftm: 0
        };
        
        // ç¯®æ¿æ•°æ®
        let reboundData = {
            home: { offensive: 0, defensive: 0 },
            away: { offensive: 0, defensive: 0 }
        };
        
        // å¯¹æ‰‹æ•°æ®
        let opponentData = {
            points: 0,
            rebounds: { offensive: 0, defensive: 0 },
            turnovers: 0,
            fouls: 0
        };
        
        // æ¨¡æ€æ¡†ç›¸å…³å˜é‡
        let currentShotPoints = 0;
        let currentReboundTeam = '';
        
        // æ¢äººç›¸å…³å˜é‡
        let substitutionOutPlayerId = null;
        let substitutionInPlayerId = null;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            renderPlayers();
            renderPlayerList();
            updatePlayingCount();
            updateSubstitutionButton();
        });
        
        // åŠ è½½æ•°æ®
        function loadData() {
            const savedData = localStorage.getItem('basketballStats');
            if (savedData) {
                const data = JSON.parse(savedData);
                players = data.players || [];
                selectedPlayerId = data.selectedPlayerId || null;
                homeScore = data.homeScore || 0;
                awayScore = data.awayScore || 0;
                quarter = data.quarter || 1;
                events = data.events || [];
                shotData = data.shotData || {};
                opponentShotData = data.opponentShotData || {
                    twoAttempts: 0,
                    twoMade: 0,
                    threeAttempts: 0,
                    threeMade: 0,
                    fta: 0,
                    ftm: 0
                };
                reboundData = data.reboundData || { home: { offensive: 0, defensive: 0 }, away: { offensive: 0, defensive: 0 } };
                opponentData = data.opponentData || { points: 0, rebounds: { offensive: 0, defensive: 0 }, turnovers: 0, fouls: 0 };
                actionHistory = data.actionHistory || [];
                
                // æ›´æ–°æ˜¾ç¤º
                updateScoreDisplay();
                document.getElementById('quarter').textContent = quarter;
                document.querySelector('.game-status span').textContent = `ç¬¬${quarter}èŠ‚`;
                renderEvents();
            } else {
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œåˆå§‹åŒ–é»˜è®¤çƒå‘˜
                initializeDefaultPlayers();
            }
        }
        
        // ä¿å­˜æ•°æ®
        function saveData() {
            const data = {
                players,
                selectedPlayerId,
                homeScore,
                awayScore,
                quarter,
                events,
                shotData,
                opponentShotData,
                reboundData,
                opponentData,
                actionHistory
            };
            localStorage.setItem('basketballStats', JSON.stringify(data));
        }
        
        // åˆå§‹åŒ–é»˜è®¤çƒå‘˜
        function initializeDefaultPlayers() {
            // æ‚¨æä¾›çš„çƒå‘˜åˆ—è¡¨
            const defaultPlayers = [
                { name: "ç‰›å¤©é½", number: 91 },
                { name: "é‡‘éœ‡ç¯", number: 11 },
                { name: "å¾å­Ÿç¨", number: 5 },
                { name: "å®‹ç¿", number: 3 },
                { name: "å¼ å®‡å¢¨", number: 4 },
                { name: "å®‹å¤ä½™", number: 14 },
                { name: "å¼ å®‡ç’ ", number: 17 },
                { name: "ç‹æ¥·æ±¶", number: 18 },
                { name: "é«˜å®‡ç«¥", number: 10 },
                { name: "ç‹å­å°§", number: 0 },
                { name: "æå† éœ‡", number: 7 },
                { name: "å¶æ…•é˜³", number: 2 },
                { name: "é»„å¤©ç•…", number: 33 },
                { name: "å¼ å¤©å®‡", number: 13 },
                { name: "ç‹è½©æµ©", number: 23 },
                { name: "æ­¦å¼˜å¥", number: 20 },
                { name: "é©¬æµšå“²", number: 6 },
                { name: "é™ˆæ˜•ç¿", number: 16 },
                { name: "é„¢ç„•ç« ", number: 77 },
                { name: "åˆ˜å“é£", number: 1 },
                { name: "é‚µåšå®£", number: 8 },
                { name: "ææ˜Šç”·", number: 30 },
                { name: "éƒ‘å²©æ˜†", number: 22 },
                { name: "å·¦ä¸€åš", number: 12 },
                { name: "äºç‰›ç‰›", number: 69 },
                { name: "æ–¹æ¢“æ—­", number: 24 },
                { name: "ç‹ä¸–å³£", number: 32 }
            ];
            
            players = defaultPlayers.map((player, index) => ({
                id: index + 1,
                name: player.name,
                number: player.number,
                starter: index < 5, // å‰5åçƒå‘˜ä¸ºé¦–å‘
                playing: index < 5, // å‰5åçƒå‘˜åœ¨åœºä¸Š
                points: 0,
                rebounds: { offensive: 0, defensive: 0 },
                assists: 0,
                steals: 0,
                blocks: 0,
                turnovers: 0,
                fouls: 0
            }));
            
            // åˆå§‹åŒ–æŠ•ç¯®æ•°æ®
            players.forEach(player => {
                shotData[player.id] = { 
                    twoAttempts: 0,
                    twoMade: 0,
                    threeAttempts: 0, 
                    threeMade: 0,
                    fta: 0,
                    ftm: 0
                };
            });
            
            saveData();
        }
        
        // æ·»åŠ é»˜è®¤çƒå‘˜
        function addDefaultPlayers() {
            if (players.length > 0) {
                if (!confirm('å½“å‰å·²æœ‰çƒå‘˜æ•°æ®ï¼Œç¡®å®šè¦æ·»åŠ é»˜è®¤çƒå‘˜å—ï¼Ÿ')) {
                    return;
                }
            }
            initializeDefaultPlayers();
            renderPlayers();
            renderPlayerList();
            updatePlayingCount();
            updateSubstitutionButton();
        }
        
        // æ¸²æŸ“çƒå‘˜åˆ—è¡¨ â€” ä»…æ˜¾ç¤ºå·ç ï¼ˆä¸Šï¼‰ä¸å§“åï¼ˆä¸‹ï¼‰ï¼Œå»æ‰ç¼©å†™ä¸å°ç»Ÿè®¡ï¼Œå¡ç‰‡æŒ‰æ¯”ä¾‹å¡«æ»¡è¡Œ
        function renderPlayers() {
            const playersContainer = document.getElementById('players-container');
            playersContainer.innerHTML = '';

            // åªæ˜¾ç¤ºåœºä¸Šçƒå‘˜
            const playingPlayers = players.filter(player => player.playing);

            if (playingPlayers.length === 0) {
                playersContainer.innerHTML = '<div class="empty-state">æš‚æ— åœºä¸Šçƒå‘˜</div>';
                return;
            }

            playingPlayers.forEach(player => {
                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${selectedPlayerId === player.id ? 'active' : ''} ${player.playing ? 'playing' : ''}`;
                playerCard.dataset.id = player.id;

                // ç®€åŒ–å±•ç¤ºï¼šä¸Šé¢å¤§å·å·ç ï¼Œä¸‹é¢å…¨åï¼ˆæ— ç¼©å†™ã€å°ç»Ÿè®¡ï¼‰
                playerCard.innerHTML = `
                    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;">
                        <div class="player-number">${player.number}</div>
                        <div class="player-name">${player.name}</div>
                    </div>
                `;

                // å¯äº¤äº’å…ƒç´ ä¸é”®ç›˜æ”¯æŒ
                playerCard.setAttribute('role', 'button');
                playerCard.tabIndex = 0;
                playerCard.setAttribute('aria-selected', selectedPlayerId === player.id ? 'true' : 'false');
                playerCard.addEventListener('click', () => selectPlayer(player.id));
                playerCard.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectPlayer(player.id);
                    }
                });

                playersContainer.appendChild(playerCard);
            });
        }

        // ç”Ÿæˆåå­—é¦–å­—æ¯ä½œä¸ºå¤´åƒå ä½
        function getInitials(name) {
            if (!name) return '';
            const parts = name.trim().split(/\s+|(?=[A-Za-z0-9])/);
            if (parts.length === 1) return parts[0].slice(0,2);
            return (parts[0][0] + (parts[1] ? parts[1][0] : '')).toUpperCase();
        }
        
        // æ¸²æŸ“çƒå‘˜ç®¡ç†åˆ—è¡¨
        function renderPlayerList() {
            const playersList = document.getElementById('players-list');
            playersList.innerHTML = '';
            
            if (players.length === 0) {
                playersList.innerHTML = '<div class="empty-state">æš‚æ— çƒå‘˜æ•°æ®</div>';
                return;
            }
            
            players.forEach(player => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                
                playerItem.innerHTML = `
                    <div>
                        <strong>${player.name} (#${player.number})</strong>
                        <div class="player-status">${player.playing ? 'åœºä¸Š' : 'æ›¿è¡¥'}</div>
                    </div>
                    <div>
                        <button class="action-btn btn-danger btn-small" onclick="deletePlayer(${player.id})">åˆ é™¤</button>
                    </div>
                `;
                
                playersList.appendChild(playerItem);
            });
        }
        
        // é€‰æ‹©çƒå‘˜
        function selectPlayer(playerId) {
            selectedPlayerId = playerId;
            renderPlayers();
            saveData();
        }
        
        // æ·»åŠ çƒå‘˜
        function addPlayer() {
            const nameInput = document.getElementById('player-name');
            const numberInput = document.getElementById('player-number');
            
            const name = nameInput.value.trim();
            const number = parseInt(numberInput.value);
            
            if (!name || isNaN(number)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„çƒå‘˜å§“åå’Œå·ç ï¼');
                return;
            }
            
            // æ£€æŸ¥å·ç æ˜¯å¦å·²å­˜åœ¨
            if (players.some(player => player.number === number)) {
                alert('è¯¥å·ç å·²è¢«ä½¿ç”¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–å·ç ï¼');
                return;
            }
            
            const player = {
                id: Date.now(),
                name: name,
                number: number,
                starter: false,
                playing: false,
                points: 0,
                rebounds: { offensive: 0, defensive: 0 },
                assists: 0,
                steals: 0,
                blocks: 0,
                turnovers: 0,
                fouls: 0
            };
            
            players.push(player);
            shotData[player.id] = { 
                twoAttempts: 0,
                twoMade: 0,
                threeAttempts: 0, 
                threeMade: 0,
                fta: 0,
                ftm: 0
            };
            
            renderPlayerList();
            updatePlayingCount();
            updateSubstitutionButton();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            nameInput.value = '';
            numberInput.value = '';
            
            saveData();
        }
        
        // åˆ é™¤çƒå‘˜ - æ·»åŠ è‡ªåŠ¨è¡¥ä½åŠŸèƒ½
        function deletePlayer(playerId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™åçƒå‘˜å—ï¼Ÿ')) {
                const playerIndex = players.findIndex(player => player.id === playerId);
                const player = players[playerIndex];
                
                if (player.playing) {
                    // å¦‚æœåˆ é™¤çš„æ˜¯åœºä¸Šçƒå‘˜ï¼Œè‡ªåŠ¨è¡¥ä½
                    const benchPlayers = players.filter(p => !p.playing && p.id !== playerId);
                    if (benchPlayers.length > 0) {
                        // é€‰æ‹©ç¬¬ä¸€ä¸ªæ›¿è¡¥çƒå‘˜è¡¥ä½
                        const replacementPlayer = benchPlayers[0];
                        replacementPlayer.playing = true;
                        addEvent(`è‡ªåŠ¨æ¢äºº: ${player.name}è¢«åˆ é™¤, ${replacementPlayer.name}ä¸Šåœº`);
                    }
                }
                
                // åˆ é™¤çƒå‘˜
                players = players.filter(player => player.id !== playerId);
                delete shotData[playerId];
                
                renderPlayerList();
                renderPlayers();
                updateSubstitutionButton();
                saveData();
            }
        }
        
        // æ˜¾ç¤ºæŠ•ç¯®æ¨¡æ€æ¡†
        function showShotModal(points) {
            if (!selectedPlayerId) {
                alert('è¯·å…ˆé€‰æ‹©çƒå‘˜ï¼');
                return;
            }
            
            currentShotPoints = points;
            document.getElementById('shot-modal-title').textContent = `${points}åˆ†çƒè®°å½•`;
            document.getElementById('shot-modal-description').textContent = `é€‰æ‹©${points}åˆ†çƒç»“æœï¼š`;
            document.getElementById('shot-modal').style.display = 'flex';
        }
        
        // ç¡®è®¤æŠ•ç¯®ç»“æœ
        function confirmShot(made) {
            const player = players.find(p => p.id === selectedPlayerId);
            if (player) {
                // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
                const prevState = {
                    type: 'score',
                    playerId: player.id,
                    points: player.points,
                    homeScore: homeScore,
                    shotData: JSON.parse(JSON.stringify(shotData[player.id]))
                };
                
                // åˆå§‹åŒ–æŠ•ç¯®æ•°æ®
                if (!shotData[player.id]) {
                    shotData[player.id] = { 
                        twoAttempts: 0,
                        twoMade: 0,
                        threeAttempts: 0, 
                        threeMade: 0,
                        fta: 0,
                        ftm: 0
                    };
                }
                
                // æ›´æ–°æŠ•ç¯®æ•°æ®
                if (currentShotPoints === 3) {
                    shotData[player.id].threeAttempts++;
                    if (made) shotData[player.id].threeMade++;
                } else {
                    shotData[player.id].twoAttempts++;
                    if (made) shotData[player.id].twoMade++;
                }
                
                if (made) {
                    player.points = (player.points || 0) + currentShotPoints;
                    homeScore += currentShotPoints;
                    
                    // æ·»åŠ äº‹ä»¶è®°å½•
                    addEvent(`${player.name} å‘½ä¸­${currentShotPoints}åˆ†çƒ`);
                } else {
                    // æ·»åŠ æŠ•ä¸¢äº‹ä»¶è®°å½•
                    addEvent(`${player.name} ${currentShotPoints}åˆ†çƒæœªå‘½ä¸­`);
                }
                
                // æ›´æ–°æ¯”åˆ†æ˜¾ç¤º
                updateScoreDisplay();
                renderPlayers();
                
                // ä¿å­˜å†å²è®°å½•
                prevState.newPoints = player.points;
                prevState.newHomeScore = homeScore;
                prevState.newShotData = JSON.parse(JSON.stringify(shotData[player.id]));
                actionHistory.push(prevState);
                
                closeModal('shot-modal');
                saveData();
            }
        }
        
        // æ˜¾ç¤ºç½šçƒæ¨¡æ€æ¡†
        function showFreeThrowModal() {
            if (!selectedPlayerId) {
                alert('è¯·å…ˆé€‰æ‹©çƒå‘˜ï¼');
                return;
            }
            
            document.getElementById('free-throw-modal').style.display = 'flex';
        }
        
        // ç¡®è®¤ç½šçƒç»“æœ
        function confirmFreeThrow(made) {
            const player = players.find(p => p.id === selectedPlayerId);
            if (player) {
                // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
                const prevState = {
                    type: 'freeThrow',
                    playerId: player.id,
                    points: player.points,
                    homeScore: homeScore,
                    shotData: JSON.parse(JSON.stringify(shotData[player.id]))
                };
                
                // åˆå§‹åŒ–æŠ•ç¯®æ•°æ®
                if (!shotData[player.id]) {
                    shotData[player.id] = { 
                        twoAttempts: 0,
                        twoMade: 0,
                        threeAttempts: 0, 
                        threeMade: 0,
                        fta: 0,
                        ftm: 0
                    };
                }
                
                // æ›´æ–°æŠ•ç¯®æ•°æ®
                shotData[player.id].fta++;
                if (made) {
                    shotData[player.id].ftm++;
                    player.points = (player.points || 0) + 1;
                    homeScore += 1;
                    
                    // æ·»åŠ äº‹ä»¶è®°å½•
                    addEvent(`${player.name} ç½šçƒå‘½ä¸­`);
                } else {
                    // æ·»åŠ æŠ•ä¸¢äº‹ä»¶è®°å½•
                    addEvent(`${player.name} ç½šçƒæœªå‘½ä¸­`);
                }
                
                // æ›´æ–°æ¯”åˆ†æ˜¾ç¤º
                updateScoreDisplay();
                renderPlayers();
                
                // ä¿å­˜å†å²è®°å½•
                prevState.newPoints = player.points;
                prevState.newHomeScore = homeScore;
                prevState.newShotData = JSON.parse(JSON.stringify(shotData[player.id]));
                actionHistory.push(prevState);
                
                closeModal('free-throw-modal');
                saveData();
            }
        }
        
        // æ˜¾ç¤ºç¯®æ¿æ¨¡æ€æ¡†
        function showReboundModal(team) {
            currentReboundTeam = team;
            
            if (team === 'home' && !selectedPlayerId) {
                alert('è¯·å…ˆé€‰æ‹©çƒå‘˜ï¼');
                return;
            }
            
            document.getElementById('rebound-modal-title').textContent = `${team === 'home' ? 'æˆ‘æ–¹' : 'å¯¹æ‰‹'}ç¯®æ¿è®°å½•`;
            document.getElementById('rebound-modal-description').textContent = `é€‰æ‹©${team === 'home' ? 'æˆ‘æ–¹' : 'å¯¹æ‰‹'}ç¯®æ¿ç±»å‹ï¼š`;
            document.getElementById('rebound-modal').style.display = 'flex';
        }
        
        // ç¡®è®¤ç¯®æ¿ç±»å‹
        function confirmRebound(type) {
            if (currentReboundTeam === 'home') {
                // æˆ‘æ–¹ç¯®æ¿
                if (!selectedPlayerId) {
                    alert('è¯·å…ˆé€‰æ‹©çƒå‘˜ï¼');
                    return;
                }
                
                const player = players.find(p => p.id === selectedPlayerId);
                if (player) {
                    // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
                    const prevState = {
                        type: 'rebound',
                        playerId: player.id,
                        reboundType: type,
                        rebounds: JSON.parse(JSON.stringify(player.rebounds)),
                        teamRebounds: JSON.parse(JSON.stringify(reboundData.home))
                    };
                    
                    player.rebounds[type] = (player.rebounds[type] || 0) + 1;
                    reboundData.home[type] = (reboundData.home[type] || 0) + 1;
                    
                    // æ·»åŠ äº‹ä»¶è®°å½•
                    addEvent(`${player.name} æŠ¢åˆ°${type === 'offensive' ? 'è¿›æ”»' : 'é˜²å®ˆ'}ç¯®æ¿`);
                    
                    // ä¿å­˜å†å²è®°å½•
                    prevState.newRebounds = JSON.parse(JSON.stringify(player.rebounds));
                    prevState.newTeamRebounds = JSON.parse(JSON.stringify(reboundData.home));
                    actionHistory.push(prevState);
                    
                    renderPlayers();
                }
            } else {
                // å¯¹æ‰‹ç¯®æ¿
                // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
                const prevState = {
                    type: 'opponentRebound',
                    reboundType: type,
                    rebounds: JSON.parse(JSON.stringify(reboundData.away))
                };
                
                reboundData.away[type] = (reboundData.away[type] || 0) + 1;
                opponentData.rebounds[type] = (opponentData.rebounds[type] || 0) + 1;
                
                // æ·»åŠ äº‹ä»¶è®°å½•
                addEvent(`å¯¹æ‰‹æŠ¢åˆ°${type === 'offensive' ? 'è¿›æ”»' : 'é˜²å®ˆ'}ç¯®æ¿`);
                
                // ä¿å­˜å†å²è®°å½•
                prevState.newRebounds = JSON.parse(JSON.stringify(reboundData.away));
                actionHistory.push(prevState);
            }
            
            closeModal('rebound-modal');
            saveData();
        }
        
        // æ˜¾ç¤ºå¯¹æ‰‹æŠ•ç¯®æ¨¡æ€æ¡†
        function showOpponentShotModal(points) {
            currentShotPoints = points;
            document.getElementById('opponent-shot-modal-title').textContent = `å¯¹æ‰‹${points}åˆ†çƒè®°å½•`;
            document.getElementById('opponent-shot-modal-description').textContent = `é€‰æ‹©å¯¹æ‰‹${points}åˆ†çƒç»“æœï¼š`;
            document.getElementById('opponent-shot-modal').style.display = 'flex';
        }
        
        // ç¡®è®¤å¯¹æ‰‹æŠ•ç¯®ç»“æœ
        function confirmOpponentShot(made) {
            // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
            const prevState = {
                type: 'opponentScore',
                points: currentShotPoints,
                made: made,
                awayScore: awayScore,
                shotData: JSON.parse(JSON.stringify(opponentShotData))
            };
            
            // æ›´æ–°å¯¹æ‰‹æŠ•ç¯®æ•°æ®
            if (currentShotPoints === 3) {
                opponentShotData.threeAttempts++;
                if (made) opponentShotData.threeMade++;
            } else {
                opponentShotData.twoAttempts++;
                if (made) opponentShotData.twoMade++;
            }
            
            if (made) {
                awayScore += currentShotPoints;
                opponentData.points += currentShotPoints;
                addEvent(`å¯¹æ‰‹å‘½ä¸­${currentShotPoints}åˆ†çƒ`);
            } else {
                addEvent(`å¯¹æ‰‹${currentShotPoints}åˆ†çƒæœªå‘½ä¸­`);
            }
            
            updateScoreDisplay();
            
            // ä¿å­˜å†å²è®°å½•
            prevState.newAwayScore = awayScore;
            prevState.newShotData = JSON.parse(JSON.stringify(opponentShotData));
            actionHistory.push(prevState);
            
            closeModal('opponent-shot-modal');
            saveData();
        }
        
        // æ˜¾ç¤ºå¯¹æ‰‹ç½šçƒæ¨¡æ€æ¡†
        function showOpponentFreeThrowModal() {
            document.getElementById('opponent-free-throw-modal').style.display = 'flex';
        }
        
        // ç¡®è®¤å¯¹æ‰‹ç½šçƒç»“æœ
        function confirmOpponentFreeThrow(made) {
            // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
            const prevState = {
                type: 'opponentFreeThrow',
                made: made,
                awayScore: awayScore,
                shotData: JSON.parse(JSON.stringify(opponentShotData))
            };
            
            // æ›´æ–°å¯¹æ‰‹æŠ•ç¯®æ•°æ®
            opponentShotData.fta++;
            if (made) {
                opponentShotData.ftm++;
                awayScore += 1;
                opponentData.points += 1;
                addEvent(`å¯¹æ‰‹ç½šçƒå‘½ä¸­`);
            } else {
                addEvent(`å¯¹æ‰‹ç½šçƒæœªå‘½ä¸­`);
            }
            
            updateScoreDisplay();
            
            // ä¿å­˜å†å²è®°å½•
            prevState.newAwayScore = awayScore;
            prevState.newShotData = JSON.parse(JSON.stringify(opponentShotData));
            actionHistory.push(prevState);
            
            closeModal('opponent-free-throw-modal');
            saveData();
        }
        
        // è®°å½•ç»Ÿè®¡æ•°æ®
        function recordStat(statType) {
            if (!selectedPlayerId) {
                alert('è¯·å…ˆé€‰æ‹©çƒå‘˜ï¼');
                return;
            }
            
            const player = players.find(p => p.id === selectedPlayerId);
            if (!player) return;
            
            // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
            const prevState = {
                type: 'stat',
                playerId: player.id,
                statType: statType,
                statValue: player[statType + 's'] || 0
            };
            
            let description = '';
            
            switch(statType) {
                case 'assist':
                    player.assists = (player.assists || 0) + 1;
                    description = `${player.name} åŠ©æ”»`;
                    break;
                case 'steal':
                    player.steals = (player.steals || 0) + 1;
                    description = `${player.name} æŠ¢æ–­`;
                    break;
                case 'block':
                    player.blocks = (player.blocks || 0) + 1;
                    description = `${player.name} ç›–å¸½`;
                    break;
                case 'turnover':
                    player.turnovers = (player.turnovers || 0) + 1;
                    description = `${player.name} å¤±è¯¯`;
                    break;
                case 'foul':
                    player.fouls = (player.fouls || 0) + 1;
                    description = `${player.name} çŠ¯è§„`;
                    break;
            }
            
            addEvent(description);
            
            // ä¿å­˜å†å²è®°å½•
            prevState.newStatValue = player[statType + 's'] || 0;
            actionHistory.push(prevState);
            
            saveData();
        }
        
        // è®°å½•å¯¹æ‰‹ç»Ÿè®¡æ•°æ®
        function recordOpponentStat(statType) {
            // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
            const prevState = {
                type: 'opponentStat',
                statType: statType,
                statValue: opponentData[statType + 's'] || 0
            };
            
            let description = '';
            
            switch(statType) {
                case 'turnover':
                    opponentData.turnovers = (opponentData.turnovers || 0) + 1;
                    description = `å¯¹æ‰‹å¤±è¯¯`;
                    break;
                case 'foul':
                    opponentData.fouls = (opponentData.fouls || 0) + 1;
                    description = `å¯¹æ‰‹çŠ¯è§„`;
                    break;
            }
            
            addEvent(description);
            
            // ä¿å­˜å†å²è®°å½•
            prevState.newStatValue = opponentData[statType + 's'] || 0;
            actionHistory.push(prevState);
            
            saveData();
        }
        
        // æ˜¾ç¤ºæ¢äººæ¨¡æ€æ¡†
        function showSubstitutionModal() {
            const outPlayers = document.getElementById('out-players');
            const inPlayers = document.getElementById('in-players');
            
            outPlayers.innerHTML = '';
            inPlayers.innerHTML = '';
            
            substitutionOutPlayerId = null;
            substitutionInPlayerId = null;
            
            // æ·»åŠ åœºä¸Šçƒå‘˜ï¼ˆå¯æ¢ä¸‹ï¼‰
            const playingPlayers = players.filter(p => p.playing);
            if (playingPlayers.length === 0) {
                alert('æ²¡æœ‰çƒå‘˜åœ¨åœºä¸Šï¼Œæ— æ³•æ¢äººï¼');
                return;
            }
            
            playingPlayers.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-card';
                playerDiv.dataset.id = player.id;
                playerDiv.innerHTML = `
                    <div class="player-number">${player.number}</div>
                    <div class="player-name">${player.name}</div>
                `;
                
                playerDiv.addEventListener('click', function() {
                    document.querySelectorAll('#out-players .player-card').forEach(p => {
                        p.classList.remove('active');
                    });
                    this.classList.add('active');
                    substitutionOutPlayerId = player.id;
                });
                
                outPlayers.appendChild(playerDiv);
            });
            
            // æ·»åŠ æ›¿è¡¥çƒå‘˜ï¼ˆå¯æ¢ä¸Šï¼‰
            const benchPlayers = players.filter(p => !p.playing);
            if (benchPlayers.length === 0) {
                alert('æ²¡æœ‰æ›¿è¡¥çƒå‘˜ï¼Œæ— æ³•æ¢äººï¼');
                return;
            }
            
            benchPlayers.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-card';
                playerDiv.dataset.id = player.id;
                playerDiv.innerHTML = `
                    <div class="player-number">${player.number}</div>
                    <div class="player-name">${player.name}</div>
                `;
                
                playerDiv.addEventListener('click', function() {
                    document.querySelectorAll('#in-players .player-card').forEach(p => {
                        p.classList.remove('active');
                    });
                    this.classList.add('active');
                    substitutionInPlayerId = player.id;
                });
                
                inPlayers.appendChild(playerDiv);
            });
            
            document.getElementById('substitution-modal').style.display = 'flex';
        }
        
        // ç¡®è®¤æ¢äºº
        function confirmSubstitution() {
            if (!substitutionOutPlayerId || !substitutionInPlayerId) {
                alert('è¯·é€‰æ‹©ä¸‹åœºå’Œä¸Šåœºçƒå‘˜ï¼');
                return;
            }
            
            const outPlayer = players.find(p => p.id === substitutionOutPlayerId);
            const inPlayer = players.find(p => p.id === substitutionInPlayerId);
            
            if (!outPlayer || !inPlayer) {
                alert('çƒå‘˜æ•°æ®é”™è¯¯ï¼');
                return;
            }
            
            // ä¿å­˜å½“å‰çŠ¶æ€ç”¨äºæ’¤é”€
            const prevState = {
                type: 'substitution',
                outPlayerId: outPlayer.id,
                inPlayerId: inPlayer.id,
                outPlayerPlaying: outPlayer.playing,
                inPlayerPlaying: inPlayer.playing
            };
            
            // æ›´æ–°çƒå‘˜çŠ¶æ€
            outPlayer.playing = false;
            inPlayer.playing = true;
            
            // æ·»åŠ äº‹ä»¶è®°å½•
            addEvent(`æ¢äºº: ${outPlayer.name}ä¸‹, ${inPlayer.name}ä¸Š`);
            
            // é‡æ–°æ¸²æŸ“çƒå‘˜åˆ—è¡¨
            renderPlayers();
            renderPlayerList();
            updatePlayingCount();
            updateSubstitutionButton();
            
            // ä¿å­˜å†å²è®°å½•
            prevState.newOutPlayerPlaying = outPlayer.playing;
            prevState.newInPlayerPlaying = inPlayer.playing;
            actionHistory.push(prevState);
            
            closeModal('substitution-modal');
            saveData();
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // æ˜¾ç¤ºé‡ç½®æ¨¡æ€æ¡†
        function showResetModal() {
            document.getElementById('reset-modal').style.display = 'flex';
        }
        
        // é‡ç½®æ•°æ®
        function resetData() {
            // æ¸…ç©ºæ‰€æœ‰æ•°æ®
            players = [];
            selectedPlayerId = null;
            homeScore = 0;
            awayScore = 0;
            quarter = 1;
            events = [];
            actionHistory = [];
            shotData = {};
            opponentShotData = {
                twoAttempts: 0,
                twoMade: 0,
                threeAttempts: 0,
                threeMade: 0,
                fta: 0,
                ftm: 0
            };
            reboundData = {
                home: { offensive: 0, defensive: 0 },
                away: { offensive: 0, defensive: 0 }
            };
            opponentData = {
                points: 0,
                rebounds: { offensive: 0, defensive: 0 },
                turnovers: 0,
                fouls: 0
            };
            
            // é‡æ–°åˆå§‹åŒ–é»˜è®¤çƒå‘˜
            initializeDefaultPlayers();
            
            // æ›´æ–°æ˜¾ç¤º
            updateScoreDisplay();
            document.getElementById('quarter').textContent = quarter;
            document.querySelector('.game-status span').textContent = `ç¬¬${quarter}èŠ‚`;
            renderPlayers();
            renderPlayerList();
            updatePlayingCount();
            updateSubstitutionButton();
            renderEvents();
            
            closeModal('reset-modal');
            saveData();
            
            alert('æ•°æ®å·²é‡ç½®ï¼');
        }
        
        // æ·»åŠ äº‹ä»¶è®°å½•
        function addEvent(description) {
            const eventsContainer = document.getElementById('events-container');
            
            // æ¸…é™¤"æš‚æ— äº‹ä»¶è®°å½•"
            if (eventsContainer.firstChild && eventsContainer.firstChild.classList.contains('empty-state')) {
                eventsContainer.innerHTML = '';
            }
            
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            eventItem.innerHTML = `
                <span>${description}</span>
                <span class="event-undo" onclick="undoLastAction()">æ’¤é”€</span>
            `;
            
            // æ·»åŠ åˆ°é¡¶éƒ¨
            if (eventsContainer.firstChild) {
                eventsContainer.insertBefore(eventItem, eventsContainer.firstChild);
            } else {
                eventsContainer.appendChild(eventItem);
            }
            
            // é™åˆ¶äº‹ä»¶æ•°é‡
            if (eventsContainer.children.length > 10) {
                eventsContainer.removeChild(eventsContainer.lastChild);
            }
            
            // ä¿å­˜åˆ°äº‹ä»¶æ•°ç»„
            events.unshift(description);
            if (events.length > 10) {
                events.pop();
            }
        }
        
        // æ¸²æŸ“äº‹ä»¶è®°å½•
        function renderEvents() {
            const eventsContainer = document.getElementById('events-container');
            eventsContainer.innerHTML = '';
            
            if (events.length === 0) {
                eventsContainer.innerHTML = '<div class="empty-state">æš‚æ— äº‹ä»¶è®°å½•</div>';
                return;
            }
            
            events.forEach(event => {
                const eventItem = document.createElement('div');
                eventItem.className = 'event-item';
                eventItem.innerHTML = `
                    <span>${event}</span>
                    <span class="event-undo" onclick="undoLastAction()">æ’¤é”€</span>
                `;
                eventsContainer.appendChild(eventItem);
            });
        }
        
        // æ›´æ–°æ¯”åˆ†æ˜¾ç¤º
        function updateScoreDisplay() {
            document.getElementById('home-score').textContent = homeScore;
            document.getElementById('away-score').textContent = awayScore;
        }
        
        // æ›´æ–°åœºä¸Šçƒå‘˜è®¡æ•°
        function updatePlayingCount() {
            const playingCount = players.filter(p => p.playing).length;
            document.getElementById('playing-count').textContent = `åœºä¸Š: ${playingCount}/5`;
        }
        
        // æ›´æ–°æ¢äººæŒ‰é’®çŠ¶æ€
        function updateSubstitutionButton() {
            const substitutionBtn = document.getElementById('substitution-btn');
            const playingCount = players.filter(p => p.playing).length;
            const benchCount = players.filter(p => !p.playing).length;
            
            if (playingCount === 0 || benchCount === 0) {
                substitutionBtn.disabled = true;
                substitutionBtn.title = playingCount === 0 ? 'æ²¡æœ‰çƒå‘˜åœ¨åœºä¸Š' : 'æ²¡æœ‰æ›¿è¡¥çƒå‘˜';
            } else {
                substitutionBtn.disabled = false;
                substitutionBtn.title = '';
            }
        }
        
        // ä¸‹ä¸€èŠ‚
        function nextQuarter() {
            quarter++;
            
            if (quarter > 4) {
                alert('æ¯”èµ›å·²ç»ç»“æŸï¼');
                quarter = 4;
                return;
            }
            
            document.getElementById('quarter').textContent = quarter;
            document.querySelector('.game-status span').textContent = `ç¬¬${quarter}èŠ‚`;
            
            // æ·»åŠ èŠ‚é—´äº‹ä»¶
            addEvent(`ç¬¬${quarter}èŠ‚å¼€å§‹`);
            
            saveData();
        }
        
        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        // æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ
        function undoLastAction() {
            if (actionHistory.length === 0) {
                alert('æ²¡æœ‰å¯æ’¤é”€çš„æ“ä½œï¼');
                return;
            }
            
            const lastAction = actionHistory.pop();
            
            switch(lastAction.type) {
                case 'score':
                case 'freeThrow':
                    const player = players.find(p => p.id === lastAction.playerId);
                    if (player) {
                        player.points = lastAction.points;
                        homeScore = lastAction.homeScore;
                        shotData[player.id] = lastAction.shotData;
                    }
                    break;
                    
                case 'stat':
                    const statPlayer = players.find(p => p.id === lastAction.playerId);
                    if (statPlayer) {
                        statPlayer[lastAction.statType + 's'] = lastAction.statValue;
                    }
                    break;
                    
                case 'rebound':
                    const reboundPlayer = players.find(p => p.id === lastAction.playerId);
                    if (reboundPlayer) {
                        reboundPlayer.rebounds = lastAction.rebounds;
                        reboundData.home = lastAction.teamRebounds;
                    }
                    break;
                    
                case 'opponentScore':
                case 'opponentFreeThrow':
                    awayScore = lastAction.awayScore;
                    opponentShotData = lastAction.shotData;
                    if (lastAction.made) {
                        opponentData.points -= lastAction.points || 1;
                    }
                    break;
                    
                case 'opponentStat':
                    opponentData[lastAction.statType + 's'] = lastAction.statValue;
                    break;
                    
                case 'opponentRebound':
                    reboundData.away = lastAction.rebounds;
                    opponentData.rebounds[lastAction.reboundType] = lastAction.rebounds[lastAction.reboundType];
                    break;
                    
                case 'substitution':
                    const outPlayer = players.find(p => p.id === lastAction.outPlayerId);
                    const inPlayer = players.find(p => p.id === lastAction.inPlayerId);
                    if (outPlayer && inPlayer) {
                        outPlayer.playing = lastAction.outPlayerPlaying;
                        inPlayer.playing = lastAction.inPlayerPlaying;
                    }
                    break;
            }
            
            // ç§»é™¤æœ€åä¸€ä¸ªäº‹ä»¶
            if (events.length > 0) {
                events.shift();
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updateScoreDisplay();
            renderPlayers();
            renderPlayerList();
            updatePlayingCount();
            updateSubstitutionButton();
            renderEvents();
            
            saveData();
        }
        
        // å¯¼å‡ºExcelåŠŸèƒ½ - åªå¯¼å‡ºä¸Šè¿‡åœºçš„çƒå‘˜ï¼Œå¹¶åŒ…å«å®Œæ•´çš„æŠ•ç¯®æ•°æ®
        function exportToExcel() {
            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            
            // ç­›é€‰ä¸Šè¿‡åœºçš„çƒå‘˜
            const playedPlayers = players.filter(player => 
                player.playing || player.points > 0 || 
                (player.rebounds.offensive + player.rebounds.defensive) > 0 ||
                player.assists > 0 || player.steals > 0 || 
                player.blocks > 0 || player.turnovers > 0 || 
                player.fouls > 0
            );
            
            // æˆ‘æ–¹çƒå‘˜æ•°æ®
            const playerData = playedPlayers.map(player => {
                const shots = shotData[player.id] || { 
                    twoAttempts: 0,
                    twoMade: 0,
                    threeAttempts: 0, 
                    threeMade: 0,
                    fta: 0,
                    ftm: 0
                };
                
                // è®¡ç®—å„ç§å‘½ä¸­ç‡
                const twoPercentage = shots.twoAttempts > 0 ? (shots.twoMade / shots.twoAttempts * 100).toFixed(1) : 0;
                const threePercentage = shots.threeAttempts > 0 ? (shots.threeMade / shots.threeAttempts * 100).toFixed(1) : 0;
                const ftPercentage = shots.fta > 0 ? (shots.ftm / shots.fta * 100).toFixed(1) : 0;
                const totalAttempts = shots.twoAttempts + shots.threeAttempts;
                const totalMade = shots.twoMade + shots.threeMade;
                const totalPercentage = totalAttempts > 0 ? (totalMade / totalAttempts * 100).toFixed(1) : 0;
                
                return {
                    'çƒè¡£å·ç ': player.number,
                    'å§“å': player.name,
                    'å¾—åˆ†': player.points || 0,
                    '2åˆ†å‡ºæ‰‹': shots.twoAttempts,
                    '2åˆ†å‘½ä¸­': shots.twoMade,
                    '2åˆ†å‘½ä¸­ç‡': `${twoPercentage}%`,
                    '3åˆ†å‡ºæ‰‹': shots.threeAttempts,
                    '3åˆ†å‘½ä¸­': shots.threeMade,
                    '3åˆ†å‘½ä¸­ç‡': `${threePercentage}%`,
                    'æ€»å‡ºæ‰‹': totalAttempts,
                    'æ€»å‘½ä¸­': totalMade,
                    'æ€»å‘½ä¸­ç‡': `${totalPercentage}%`,
                    'ç½šçƒå‡ºæ‰‹': shots.fta,
                    'ç½šçƒå‘½ä¸­': shots.ftm,
                    'ç½šçƒå‘½ä¸­ç‡': `${ftPercentage}%`,
                    'è¿›æ”»ç¯®æ¿': player.rebounds.offensive || 0,
                    'é˜²å®ˆç¯®æ¿': player.rebounds.defensive || 0,
                    'æ€»ç¯®æ¿': (player.rebounds.offensive || 0) + (player.rebounds.defensive || 0),
                    'åŠ©æ”»': player.assists || 0,
                    'æŠ¢æ–­': player.steals || 0,
                    'ç›–å¸½': player.blocks || 0,
                    'å¤±è¯¯': player.turnovers || 0,
                    'çŠ¯è§„': player.fouls || 0,
                    'çŠ¶æ€': player.playing ? 'åœºä¸Š' : 'æ›¿è¡¥'
                };
            });
            
            const playerWs = XLSX.utils.json_to_sheet(playerData);
            XLSX.utils.book_append_sheet(wb, playerWs, "æˆ‘æ–¹çƒå‘˜æ•°æ®");
            
            // å¯¹æ‰‹æ•°æ® - åŒ…å«å®Œæ•´çš„æŠ•ç¯®æ•°æ®
            const opponentTwoPercentage = opponentShotData.twoAttempts > 0 ? 
                (opponentShotData.twoMade / opponentShotData.twoAttempts * 100).toFixed(1) : 0;
            const opponentThreePercentage = opponentShotData.threeAttempts > 0 ? 
                (opponentShotData.threeMade / opponentShotData.threeAttempts * 100).toFixed(1) : 0;
            const opponentFtPercentage = opponentShotData.fta > 0 ? 
                (opponentShotData.ftm / opponentShotData.fta * 100).toFixed(1) : 0;
            const opponentTotalAttempts = opponentShotData.twoAttempts + opponentShotData.threeAttempts;
            const opponentTotalMade = opponentShotData.twoMade + opponentShotData.threeMade;
            const opponentTotalPercentage = opponentTotalAttempts > 0 ? 
                (opponentTotalMade / opponentTotalAttempts * 100).toFixed(1) : 0;
            
            const opponentDataSheet = [{
                'å¾—åˆ†': opponentData.points || 0,
                '2åˆ†å‡ºæ‰‹': opponentShotData.twoAttempts,
                '2åˆ†å‘½ä¸­': opponentShotData.twoMade,
                '2åˆ†å‘½ä¸­ç‡': `${opponentTwoPercentage}%`,
                '3åˆ†å‡ºæ‰‹': opponentShotData.threeAttempts,
                '3åˆ†å‘½ä¸­': opponentShotData.threeMade,
                '3åˆ†å‘½ä¸­ç‡': `${opponentThreePercentage}%`,
                'æ€»å‡ºæ‰‹': opponentTotalAttempts,
                'æ€»å‘½ä¸­': opponentTotalMade,
                'æ€»å‘½ä¸­ç‡': `${opponentTotalPercentage}%`,
                'ç½šçƒå‡ºæ‰‹': opponentShotData.fta,
                'ç½šçƒå‘½ä¸­': opponentShotData.ftm,
                'ç½šçƒå‘½ä¸­ç‡': `${opponentFtPercentage}%`,
                'è¿›æ”»ç¯®æ¿': opponentData.rebounds.offensive || 0,
                'é˜²å®ˆç¯®æ¿': opponentData.rebounds.defensive || 0,
                'æ€»ç¯®æ¿': (opponentData.rebounds.offensive || 0) + (opponentData.rebounds.defensive || 0),
                'å¤±è¯¯': opponentData.turnovers || 0,
                'çŠ¯è§„': opponentData.fouls || 0
            }];
            
            const opponentWs = XLSX.utils.json_to_sheet(opponentDataSheet);
            XLSX.utils.book_append_sheet(wb, opponentWs, "å¯¹æ‰‹æ•°æ®");
            
            // æ¯”èµ›æ€»ç»“
            const summaryData = [{
                'çƒé˜Ÿ': 'æˆ‘æ–¹',
                'å¾—åˆ†': homeScore,
                'è¿›æ”»ç¯®æ¿': reboundData.home.offensive || 0,
                'é˜²å®ˆç¯®æ¿': reboundData.home.defensive || 0,
                'æ€»ç¯®æ¿': (reboundData.home.offensive || 0) + (reboundData.home.defensive || 0)
            }, {
                'çƒé˜Ÿ': 'å¯¹æ‰‹',
                'å¾—åˆ†': awayScore,
                'è¿›æ”»ç¯®æ¿': reboundData.away.offensive || 0,
                'é˜²å®ˆç¯®æ¿': reboundData.away.defensive || 0,
                'æ€»ç¯®æ¿': (reboundData.away.offensive || 0) + (reboundData.away.defensive || 0)
            }, {
                'çƒé˜Ÿ': 'åˆ†å·®',
                'å¾—åˆ†': homeScore - awayScore
            }];
            
            const summaryWs = XLSX.utils.json_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, summaryWs, "æ¯”èµ›æ€»ç»“");
            
            // å¯¼å‡ºExcelæ–‡ä»¶
            const fileName = `ç¯®çƒæ¯”èµ›æ•°æ®_${new Date().toLocaleDateString().replace(/\//g, '-')}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert(`Excelæ–‡ä»¶å·²ç”Ÿæˆï¼Œå¿«æŠŠæ–‡ä»¶å‘ç»™ç‰›å¤©é½~: ${fileName}`);
        }
    </script>
</body>
</html>
